-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\opensafely-ics-research\analysis\asthma_log_psm\02b_cr
> _derive_ps_asthma.log
  log type:  text
 opened on:  19 Aug 2020, 10:12:42

. 
. /* PS Model==================================================================
> =*/
. 
. mlogit exposure i.male age1 age2 age3 $varlist, base(0)

Iteration 0:   log likelihood =  -669403.3  
Iteration 1:   log likelihood = -645449.11  
Iteration 2:   log likelihood = -644282.85  
Iteration 3:   log likelihood = -644281.56  
Iteration 4:   log likelihood = -644281.56  

Multinomial logistic regression                 Number of obs     =    863,523
                                                LR chi2(52)       =   50243.50
                                                Prob > chi2       =     0.0000
Log likelihood = -644281.56                     Pseudo R2         =     0.0375

------------------------------------------------------------------------------
    exposure |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
SABA_only    |  (base outcome)
-------------+----------------------------------------------------------------
ICS__Low_M~_ |
      1.male |   .0203576   .0063414     3.21   0.001     .0079287    .0327866
        age1 |   .0081599   .0008636     9.45   0.000     .0064673    .0098525
        age2 |   .0217321   .0027232     7.98   0.000     .0163947    .0270694
        age3 |  -.0968717   .0089224   -10.86   0.000    -.1143594   -.0793841
             |
   obese4cat |
Obese I ..)  |   .0509822   .0081622     6.25   0.000     .0349845    .0669798
Obese II..)  |   .0458828    .011173     4.11   0.000     .0239841    .0677814
Obese II..)  |   .0179976   .0138813     1.30   0.195    -.0092093    .0452044
             |
smoke_nomiss |
     Former  |   -.046599   .0069223    -6.73   0.000    -.0601665   -.0330315
    Current  |  -.2083227   .0088311   -23.59   0.000    -.2256313   -.1910142
             |
         imd |
          2  |  -.0009164   .0097749    -0.09   0.925     -.020075    .0182421
          3  |  -.0042761   .0097716    -0.44   0.662    -.0234282    .0148759
          4  |   .0168001   .0097759     1.72   0.086    -.0023602    .0359604
5 most de..  |   .0800821   .0100746     7.95   0.000     .0603362    .0998279
             |
         ckd |
        CKD  |  -.1259408   .0159603    -7.89   0.000    -.1572225   -.0946592
1.hyperten~n |  -.0579514    .008757    -6.62   0.000    -.0751148   -.0407881
1.heart_f~re |   -.158807   .0233993    -6.79   0.000    -.2046689   -.1129452
1.other_h~se |  -.1592455   .0137127   -11.61   0.000     -.186122   -.1323691
             |
     diabcat |
Controlle..  |   -.195743   .0120018   -16.31   0.000    -.2192661   -.1722199
Uncontrol..  |  -.4904171   .0154011   -31.84   0.000    -.5206026   -.4602315
Diabetes,..  |   .0122982   .0540175     0.23   0.820    -.0935741    .1181706
             |
1.cancer_e~r |  -.1456179   .0138888   -10.48   0.000    -.1728394   -.1183965
    1.statin |   .0643943   .0103388     6.23   0.000     .0441307    .0846579
1.flu_vacc~e |   .8238857   .0068482   120.31   0.000     .8104635    .8373079
1.pneumoco~e |   .0122894   .0129505     0.95   0.343    -.0130932    .0376719
1.exacerba~s |   .3892241   .0086374    45.06   0.000     .3722951    .4061532
1.immunode~y |  -.2477227   .0526877    -4.70   0.000    -.3509887   -.1444567
       _cons |   .6597988   .0270242    24.42   0.000     .6068325    .7127652
-------------+----------------------------------------------------------------
ICS__High_~_ |
      1.male |   .0307195   .0088753     3.46   0.001     .0133242    .0481147
        age1 |   .0405135   .0014075    28.78   0.000     .0377549    .0432721
        age2 |  -.0380112   .0041092    -9.25   0.000    -.0460651   -.0299573
        age3 |   .0441846   .0130611     3.38   0.001     .0185854    .0697839
             |
   obese4cat |
Obese I ..)  |    .163591   .0110292    14.83   0.000     .1419742    .1852079
Obese II..)  |   .2549563    .014656    17.40   0.000      .226231    .2836815
Obese II..)  |   .3380084    .017744    19.05   0.000     .3032308    .3727861
             |
smoke_nomiss |
     Former  |   .0044303   .0094729     0.47   0.640    -.0141363     .022997
    Current  |  -.0770517   .0126575    -6.09   0.000    -.1018599   -.0522434
             |
         imd |
          2  |    .046046   .0138543     3.32   0.001     .0188922    .0731999
          3  |   .1161215    .013747     8.45   0.000     .0891779    .1430651
          4  |   .1874908   .0136777    13.71   0.000      .160683    .2142986
5 most de..  |   .3099656   .0139538    22.21   0.000     .2826166    .3373147
             |
         ckd |
        CKD  |  -.0974415   .0203552    -4.79   0.000    -.1373369   -.0575461
1.hyperten~n |  -.0126796    .011461    -1.11   0.269    -.0351428    .0097835
1.heart_f~re |  -.0101084   .0293827    -0.34   0.731    -.0676973    .0474806
1.other_h~se |  -.0826934   .0176424    -4.69   0.000    -.1172719   -.0481149
             |
     diabcat |
Controlle..  |  -.0984673   .0153612    -6.41   0.000    -.1285747   -.0683599
Uncontrol..  |  -.4255495   .0205188   -20.74   0.000    -.4657656   -.3853335
Diabetes,..  |   .0420132   .0749976     0.56   0.575    -.1049794    .1890059
             |
1.cancer_e~r |  -.1311123   .0182961    -7.17   0.000    -.1669721   -.0952526
    1.statin |    .100527   .0132713     7.57   0.000     .0745158    .1265382
1.flu_vacc~e |   .9173092   .0095155    96.40   0.000     .8986591    .9359593
1.pneumoco~e |   .0742189    .016317     4.55   0.000     .0422382    .1061996
1.exacerba~s |    1.17113   .0104056   112.55   0.000     1.150735    1.191525
1.immunode~y |  -.2564191   .0740899    -3.46   0.001    -.4016326   -.1112056
       _cons |  -2.845295    .045564   -62.45   0.000    -2.934599   -2.755991
------------------------------------------------------------------------------

. predict p0 p1 p2, pr 

. 
. bysort exposure: summarize p0 

-------------------------------------------------------------------------------
-> exposure = SABA only

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          p0 |    134,067    .1883975    .0734497   .0424951   .4877366

-------------------------------------------------------------------------------
-> exposure = ICS (Low/Medium Dose)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          p0 |    626,669    .1513415    .0699693   .0414254   .4558699

-------------------------------------------------------------------------------
-> exposure = ICS (High Dose)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          p0 |    102,787    .1358936    .0664654   .0421851   .4490869

-------------------------------------------------------------------------------
-> exposure = Other

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          p0 |    468,094    .2059713    .0730715   .0432761   .4547831


. bysort exposure: summarize p1 

-------------------------------------------------------------------------------
-> exposure = SABA only

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          p1 |    134,067    .7073314    .0558075   .4251903    .825336

-------------------------------------------------------------------------------
-> exposure = ICS (Low/Medium Dose)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          p1 |    626,669     .730284    .0572013   .4769354   .8259591

-------------------------------------------------------------------------------
-> exposure = ICS (High Dose)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          p1 |    102,787    .7218114    .0563076   .4670801   .8252552

-------------------------------------------------------------------------------
-> exposure = Other

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          p1 |    468,094    .7044478    .0542111   .4777979   .8258414


. bysort exposure: summarize p2 

-------------------------------------------------------------------------------
-> exposure = SABA only

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          p2 |    134,067    .1042711    .0463776   .0350615   .3751729

-------------------------------------------------------------------------------
-> exposure = ICS (Low/Medium Dose)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          p2 |    626,669    .1183745    .0515744   .0321293   .4028778

-------------------------------------------------------------------------------
-> exposure = ICS (High Dose)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          p2 |    102,787    .1422949     .061109   .0347917   .3797476

-------------------------------------------------------------------------------
-> exposure = Other

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          p2 |    468,094     .089581    .0384218   .0327221   .3737654


. 
. gen check = p0 + p1 + p2 

. summarize check 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       check |  1,331,617           1    7.01e-09   .9999999          1

. 
. * Estimate and tabulate standardised differences 
. * Note, this relies on the stddiff ado, provided in the repo. 
. * Because 3 level treatment, compare both against baseline, so need to create
>  indicators for this
. 
. gen exposure1v0 = 0 if exposure == 0 
(1,197,550 missing values generated)

. replace exposure1v0 = 1 if exposure == 1 
(626,669 real changes made)

. 
. gen exposure2v0 = 0 if exposure == 0 
(1,197,550 missing values generated)

. replace exposure2v0 = 1 if exposure == 2 
(102,787 real changes made)

. 
. local lab0: label exposure 0

. local lab1: label exposure 1

. local lab2: label exposure 2

. 
. cap file close tablecontent

. file open tablecontent using ./$outdir/table_stddiff.txt, write text replace

. 
. file write tablecontent ("Table S1: Standardised differences before weighting
> ") _n

. file write tablecontent ("Variable") _tab ("SD - `lab1' vs `lab0'") _tab ("SD
>  - `lab2' vs `lab0'") _n 

. 
. *Gender
. 
.     local lab: variable label male 

.     file write tablecontent ("`lab'") _tab

.         
.         stddiff i.male, by(exposure1v0)

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
        male |                         |                         |
           0 |     76804        (57.3) |    373481        (59.6) |    0.04689
           1 |     57263        (42.7) |    253188        (40.4) | 
------------------------------------------------------------------------------

.         file write tablecontent (r(stddiff)[1,1]) _tab

.         
.         stddiff i.male, by(exposure2v0)

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
        male |                         |                         |
           0 |     76804        (57.3) |     63477        (61.8) |    0.09112
           1 |     57263        (42.7) |     39310        (38.2) | 
------------------------------------------------------------------------------

.         file write tablecontent (r(stddiff)[1,1]) _n 

. 
. *Age
. 
.     local lab: variable label age

.     file write tablecontent ("`lab'") _tab

.         
.         stddiff age, by(exposure1v0)

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         age |     48.23        17.445 |     53.06        17.392 |   -0.27764
------------------------------------------------------------------------------

.         file write tablecontent (r(stddiff)[1,1]) _tab

.         
.         stddiff age, by(exposure2v0)

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         age |     48.23        17.445 |     55.02        16.348 |   -0.40152
------------------------------------------------------------------------------

.         file write tablecontent (r(stddiff)[1,1]) _n 

.         
. * All other things 
. 
. foreach comorb in $varlist {
  2. 
.     local comorb: subinstr local comorb "i." ""
  3.     local lab: variable label `comorb'
  4.     file write tablecontent ("`lab'") _tab
  5.         
.         stddiff `comorb', by(exposure1v0)
  6.         file write tablecontent (r(stddiff)[1,1]) _tab 
  7.         
.         stddiff `comorb', by(exposure2v0)
  8.         file write tablecontent (r(stddiff)[1,1]) _n                      
>       
  9. }

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
   obese4cat |     1.525        .86992 |     1.555        .87734 |   -0.03386
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
   obese4cat |     1.525        .86992 |     1.699        .96613 |   -0.18941
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
smoke_nomiss |     1.778         .7526 |       1.7        .70267 |    0.10659
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
smoke_nomiss |     1.778         .7526 |     1.748        .70755 |    0.04069
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         imd |     3.021         1.402 |     2.971        1.4075 |    0.03593
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         imd |     3.021         1.402 |     3.119         1.406 |   -0.06986
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         ckd |    .04785        .21345 |    .05819        .23411 |   -0.04618
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         ckd |    .04785        .21345 |    .06996        .25508 |   -0.09401
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
hypertension |     .2363        .42482 |     .2888        .45318 |   -0.11936
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
hypertension |     .2363        .42482 |     .3351        .47202 |   -0.21991
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
heart_fai~re |    .01947        .13816 |    .02083        .14282 |   -0.00971
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
heart_fai~re |    .01947        .13816 |    .02965        .16963 |   -0.06584
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
other_hea~se |    .06496        .24646 |    .07218        .25879 |   -0.02857
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
other_hea~se |    .06496        .24646 |    .09076        .28727 |   -0.09640
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
     diabcat |     1.192        .52451 |     1.188        .50524 |    0.00873
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
     diabcat |     1.192        .52451 |     1.238        .55544 |   -0.08538
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
 cancer_ever |    .05333        .22469 |     .0616        .24043 |   -0.03554
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
 cancer_ever |    .05333        .22469 |    .06687        .24979 |   -0.05697
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
      statin |     .1659        .37203 |     .2175        .41252 |   -0.13115
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
      statin |     .1659        .37203 |     .2591        .43812 |   -0.22908
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
 flu_vaccine |      .374        .48387 |     .5975        .49039 |   -0.45889
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
 flu_vaccine |      .374        .48387 |     .6397         .4801 |   -0.55117
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
pneumococc~e |    .05914        .23589 |     .0832        .27618 |   -0.09367
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
pneumococc~e |    .05914        .23589 |    .09819        .29758 |   -0.14544
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
exacerbati~s |     .1407         .3477 |     .1988        .39909 |   -0.15522
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
exacerbati~s |     .1407         .3477 |     .3611        .48033 |   -0.52575
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
immunodef_~y |   .003536       .059355 |   .002915       .053916 |    0.01094
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
immunodef_~y |   .003536       .059355 |   .003142       .055969 |    0.00681
------------------------------------------------------------------------------

. 
. file close tablecontent

. 
. /* Create weights============================================================
> =*/
. 
. * ATE weights 
. gen ipw = 1/p0 if exposure == 0 
(1,197,550 missing values generated)

. replace ipw = 1/p1 if exposure == 1 
(626,669 real changes made)

. replace ipw = 1/p2 if exposure == 2 
(102,787 real changes made)

. 
. summarize ipw, d

                             ipw
-------------------------------------------------------------
      Percentiles      Smallest
 1%     1.225716       1.210714
 5%     1.241735       1.210799
10%     1.255766       1.210799       Obs             863,523
25%     1.296839       1.211064       Sum of Wgt.     863,523

50%     1.445459                      Mean           2.998098
                        Largest       Std. Dev.      3.202677
75%     3.644858       27.89028
90%     8.362579       27.89028       Variance       10.25714
95%     10.40491       27.89028       Skewness       2.233269
99%     14.50313       28.74253       Kurtosis       8.059296

. 
. * ATT weights
. * Multiplied by the treatment score in high dose (=p2).  
. gen ipw_att = 1 if exposure == 2
(1,228,830 missing values generated)

. replace ipw_att = p2/p1 if exposure == 1
(626,669 real changes made)

. replace ipw_att = p2/p0 if exposure == 0
(134,067 real changes made)

. 
. summarize ipw_att, d

                           ipw_att
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .0673032       .0533209
 5%     .0908733       .0537867
10%     .1060594       .0537867       Obs             863,523
25%     .1236448       .0537867       Sum of Wgt.     863,523

50%      .159492                      Mean           .3581727
                        Largest       Std. Dev.      .4451988
75%     .3582114       6.494851
90%            1        6.96444       Variance       .1982019
95%            1       6.997122       Skewness       3.875216
99%     1.700984       7.192905       Kurtosis       28.29039

. 
. /* Check overlap and standardised differences in the weighted sample=========
> =*/
. 
. * Plot and export graphs of the PS distribution 
. * Left graph export for now for same reason as above 
. * Adapt probability weights to frequency weights to use in graphs
. * These need to be rounded up for sufficient granularity 
. 
. gen ipw_f = round(ipw*100) 
(468,094 missing values generated)

. 
. * repeat for ATT
. 
. gen ipw_fatt = round(ipw_att*100) 
(468,094 missing values generated)

. 
. * Estimate and tabulate standardised differences 
. * Note, this required amending the stddiff ado file 
. * The amended file is saved as Weighted STDs and called before calculating th
> ese 
. * The weights are frequency weights used above and in a variable called 'wts'
. 
. gen wts = ipw_f
(468,094 missing values generated)

. 
. run "Weighted STDs.do" 

. 
. cap file close tablecontent

. file open tablecontent using ./$outdir/table_stddiff2.txt, write text replace

. 
. file write tablecontent ("Table S2: Standardised differences after weighting 
> - ATE") _n

. file write tablecontent ("Variable") _tab ("SD - `lab1' vs `lab0'") _tab ("SD
>  - `lab2` vs `lab0'") _n 

. 
. *Gender
. 
.     local lab: variable label male 

.     file write tablecontent ("`lab'") _tab

.         
.         stddiff2 i.male, by(exposure1v0)

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
        male |                         |                         |
           0 |  5.14e+07        (59.5) |  5.14e+07        (59.5) |    0.00011
           1 |  3.50e+07        (40.5) |  3.50e+07        (40.5) | 
------------------------------------------------------------------------------

.         file write tablecontent (r(stddiff)[1,1]) _tab

.         
.         stddiff2 i.male, by(exposure2v0)

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
        male |                         |                         |
           0 |  5.14e+07        (59.5) |  5.13e+07        (59.6) |    0.00145
           1 |  3.50e+07        (40.5) |  3.48e+07        (40.4) | 
------------------------------------------------------------------------------

.         file write tablecontent (r(stddiff)[1,1]) _n 

. 
. *Age
. 
.     local lab: variable label age

.     file write tablecontent ("`lab'") _tab

.         
.         stddiff2 age, by(exposure1v0)

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         age |      52.9        17.529 |     52.55        17.388 |    0.01967
------------------------------------------------------------------------------

.         file write tablecontent (r(stddiff)[1,1]) _tab

.         
.         stddiff2 age, by(exposure2v0)

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         age |      52.9        17.529 |     52.77        17.407 |    0.00733
------------------------------------------------------------------------------

.         file write tablecontent (r(stddiff)[1,1]) _n 

.         
. * All other things 
. 
. foreach comorb in $varlist {
  2. 
.     local comorb: subinstr local comorb "i." ""
  3.     local lab: variable label `comorb'
  4.     file write tablecontent ("`lab'") _tab
  5.         
.         stddiff2 `comorb', by(exposure1v0)
  6.         file write tablecontent (r(stddiff)[1,1]) _tab 
  7.         
.         stddiff2 `comorb', by(exposure2v0)
  8.         file write tablecontent (r(stddiff)[1,1]) _n                      
>       
  9. }

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
   obese4cat |     1.579        .89779 |     1.568        .88906 |    0.01252
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
   obese4cat |     1.579        .89779 |     1.573        .89214 |    0.00617
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
smoke_nomiss |     1.724          .712 |     1.718        .71196 |    0.00754
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
smoke_nomiss |     1.724          .712 |     1.731        .71413 |   -0.00987
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         imd |     3.009        1.4072 |     2.997        1.4074 |    0.00835
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         imd |     3.009        1.4072 |     3.004        1.4065 |    0.00311
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         ckd |    .06099        .23931 |    .05806        .23386 |    0.01236
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         ckd |    .06099        .23931 |    .05995         .2374 |    0.00435
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
hypertension |     .2927        .45501 |     .2864        .45207 |    0.01395
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
hypertension |     .2927        .45501 |     .2902        .45386 |    0.00552
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
heart_fai~re |    .02279        .14922 |    .02172        .14577 |    0.00722
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
heart_fai~re |    .02279        .14922 |    .02254        .14844 |    0.00165
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
other_hea~se |    .07697        .26654 |     .0734        .26079 |    0.01352
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
other_hea~se |    .07697        .26654 |     .0754        .26404 |    0.00590
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
     diabcat |     1.203         .5246 |     1.195        .51538 |    0.01572
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
     diabcat |     1.203         .5246 |     1.199        .51956 |    0.00833
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
 cancer_ever |    .06208        .24129 |    .06098        .23929 |    0.00456
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
 cancer_ever |    .06208        .24129 |    .06206        .24127 |    0.00005
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
      statin |      .221        .41489 |     .2147         .4106 |    0.01522
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
      statin |      .221        .41489 |     .2176        .41262 |    0.00809
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
 flu_vaccine |      .569        .49522 |     .5677        .49539 |    0.00259
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
 flu_vaccine |      .569        .49522 |     .5691        .49521 |   -0.00015
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
pneumococc~e |    .08589        .28021 |    .08133        .27334 |    0.01649
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
pneumococc~e |    .08589        .28021 |     .0816        .27376 |    0.01550
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
exacerbati~s |      .211        .40804 |     .2093        .40679 |    0.00430
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
exacerbati~s |      .211        .40804 |     .2113        .40824 |   -0.00071
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
immunodef_~y |   .003277        .05715 |   .003055        .05519 |    0.00395
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
immunodef_~y |   .003277        .05715 |     .0031       .055588 |    0.00314
------------------------------------------------------------------------------

. 
. file close tablecontent

. 
. * Repeat for ATT
. 
. drop wts

. gen wts = ipw_fatt
(468,094 missing values generated)

. 
. run "Weighted STDs.do" 

. 
. cap file close tablecontent

. file open tablecontent using ./$outdir/table_stddiff2.txt, write text replace

. 
. file write tablecontent ("Table S3: Standardised differences after weighting 
> - ATT") _n

. file write tablecontent ("Variable") _tab ("SD - `lab1' vs `lab0'") _tab ("SD
>  - `lab2` vs `lab0'") _n 

. 
. *Gender
. 
.     local lab: variable label male 

.     file write tablecontent ("`lab'") _tab

.         
.         stddiff2 i.male, by(exposure1v0)

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
        male |                         |                         |
           0 |   6395751        (61.7) |   6356041        (61.8) |    0.00246
           1 |   3971227        (38.3) |   3926608        (38.2) | 
------------------------------------------------------------------------------

.         file write tablecontent (r(stddiff)[1,1]) _tab

.         
.         stddiff2 i.male, by(exposure2v0)

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
        male |                         |                         |
           0 |   6395751        (61.7) |   6347700        (61.8) |    0.00128
           1 |   3971227        (38.3) |   3931000        (38.2) | 
------------------------------------------------------------------------------

.         file write tablecontent (r(stddiff)[1,1]) _n 

. 
. *Age
. 
.     local lab: variable label age

.     file write tablecontent ("`lab'") _tab

.         
.         stddiff2 age, by(exposure1v0)

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         age |     55.54        16.518 |     55.03        16.341 |    0.03110
------------------------------------------------------------------------------

.         file write tablecontent (r(stddiff)[1,1]) _tab

.         
.         stddiff2 age, by(exposure2v0)

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         age |     55.54        16.518 |     55.02        16.348 |    0.03192
------------------------------------------------------------------------------

.         file write tablecontent (r(stddiff)[1,1]) _n 

.         
. * All other things 
. 
. foreach comorb in $varlist {
  2. 
.     local comorb: subinstr local comorb "i." ""
  3.     local lab: variable label `comorb'
  4.     file write tablecontent ("`lab'") _tab
  5.         
.         stddiff2 `comorb', by(exposure1v0)
  6.         file write tablecontent (r(stddiff)[1,1]) _tab 
  7.         
.         stddiff2 `comorb', by(exposure2v0)
  8.         file write tablecontent (r(stddiff)[1,1]) _n                      
>       
  9. }

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
   obese4cat |     1.719         .9778 |       1.7        .96671 |    0.01950
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
   obese4cat |     1.719         .9778 |     1.699        .96613 |    0.02068
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
smoke_nomiss |     1.756        .70708 |      1.75        .70825 |    0.00886
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
smoke_nomiss |     1.756        .70708 |     1.748        .70755 |    0.01177
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         imd |     3.138        1.4036 |     3.121        1.4061 |    0.01150
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         imd |     3.138        1.4036 |     3.119         1.406 |    0.01302
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         ckd |    .07607        .26511 |    .07009         .2553 |    0.02299
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
         ckd |    .07607        .26511 |    .06996        .25508 |    0.02349
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
hypertension |     .3445         .4752 |     .3358        .47226 |    0.01840
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
hypertension |     .3445         .4752 |     .3351        .47202 |    0.01987
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
heart_fai~re |    .03202        .17605 |    .02983        .17011 |    0.01266
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
heart_fai~re |    .03202        .17605 |    .02965        .16963 |    0.01368
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
other_hea~se |    .09733        .29641 |     .0911        .28775 |    0.02134
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
other_hea~se |    .09733        .29641 |    .09076        .28727 |    0.02251
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
     diabcat |      1.25        .56654 |     1.239         .5565 |    0.01912
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
     diabcat |      1.25        .56654 |     1.238        .55544 |    0.02101
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
 cancer_ever |    .06861        .25279 |    .06697        .24997 |    0.00652
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
 cancer_ever |    .06861        .25279 |    .06687        .24979 |    0.00693
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
      statin |     .2677        .44274 |     .2598        .43851 |    0.01791
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
      statin |     .2677        .44274 |     .2591        .43811 |    0.01955
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
 flu_vaccine |     .6472        .47785 |     .6383         .4805 |    0.01859
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
 flu_vaccine |     .6472        .47785 |     .6397         .4801 |    0.01569
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
pneumococc~e |      .105        .30653 |     .0979        .29719 |    0.02346
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
pneumococc~e |      .105        .30653 |    .09819        .29758 |    0.02248
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
exacerbati~s |     .3652        .48149 |     .3618        .48053 |    0.00697
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
exacerbati~s |     .3652        .48149 |     .3611        .48033 |    0.00845
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure1v0=0      |      exposure1v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
immunodef_~y |    .00336       .057869 |   .003163       .056148 |    0.00346
------------------------------------------------------------------------------

------------------------------------------------------------------------------
             |      exposure2v0=0      |      exposure2v0=1      |
             | Mean or N     SD or (%) | Mean or N     SD or (%) |  Std Diff
-------------+-------------------------+-------------------------+------------
immunodef_~y |    .00336       .057869 |   .003142       .055969 |    0.00382
------------------------------------------------------------------------------

. 
. file close tablecontent

. 
. /* Output weighted dataset for analyses======================================
> =*/
. 
. * Save a version set on survival outcome with IP weights (ATE)
. * Note that this will throw a probable error for invalid weights 
. * This is because we have people with missing exposure in the dataset which w
> e allow to drop at this stage
. * Those with missing exposure have missing weights and that's why there's an 
> error 
. stset stime_$outcome [pweight = ipw], fail($outcome) id(patient_id) enter(ent
> er_date) origin(enter_date)        

                id:  patient_id
     failure event:  onscoviddeath != 0 & onscoviddeath < .
obs. time interval:  (stime_onscoviddeath[_n-1], stime_onscoviddeath]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date
            weight:  [pweight=ipw]

------------------------------------------------------------------------------
  1,331,617  total observations
    468,094  weights invalid                                    PROBABLE ERROR
------------------------------------------------------------------------------
    863,523  observations remaining, representing
    863,523  subjects
        571  failures in single-failure-per-subject data
   56931867  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        66

. save $tempdir\analysis_dataset_STSET_IPW_$outcome, replace
file asthma_tempdata_psm\analysis_dataset_STSET_IPW_onscoviddeath.dta saved

. 
. * Save a version weighted on ATT weights
. stset stime_$outcome [pweight = ipw_att], fail($outcome) id(patient_id) enter
> (enter_date) origin(enter_date)    

                id:  patient_id
     failure event:  onscoviddeath != 0 & onscoviddeath < .
obs. time interval:  (stime_onscoviddeath[_n-1], stime_onscoviddeath]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date
            weight:  [pweight=ipw_att]

------------------------------------------------------------------------------
  1,331,617  total observations
    468,094  weights invalid                                    PROBABLE ERROR
------------------------------------------------------------------------------
    863,523  observations remaining, representing
    863,523  subjects
        571  failures in single-failure-per-subject data
   56931867  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        66

. save $tempdir\analysis_dataset_STSET_IPWATT_$outcome, replace
file asthma_tempdata_psm\analysis_dataset_STSET_IPWATT_onscoviddeath.dta saved

. 
. 
. * Close log file 
. log close
      name:  <unnamed>
       log:  E:\analyses\opensafely-ics-research\analysis\asthma_log_psm\02b_cr
> _derive_ps_asthma.log
  log type:  text
 closed on:  19 Aug 2020, 10:18:44
-------------------------------------------------------------------------------
